exercise: Clock
plan: 53
methods: new time add_minutes subtract_minutes
modules:
  - use: List::Util qw(any)
tests: |-
  for my $case ( map { @{ $_->{cases} } } @{ $C_DATA->{cases} } ) {
    if ( $case->{property} eq 'create' ) {
      is(
        Clock->new( $case->{input} ),
        object {
          prop blessed => 'Clock';
          call time => $case->{expected};
        },
        $case->{description}
      );
    }

    elsif ( any { $case->{property} eq $_ } qw( add subtract ) ) {
      is(
        Clock->new(
          { hour   => $case->{input}{hour},
            minute => $case->{input}{minute},
          }
        ),
        # Check that the add/subtract_minutes methods
        # return a Clock object with the correct time
        object {
          call [
            $case->{property} . '_minutes',
            $case->{input}{value}
          ] => object {
              prop blessed => 'Clock';
              call time => $case->{expected};
            };
        },
        $case->{description}
      );
    }

    elsif ( $case->{property} eq 'equal' ) {
      my ( $clock1, $clock2 )
        = ( map { Clock->new($_) } @{ $case->{input} }{qw(clock1 clock2)} );
      $case->{expected}
        ? is $clock1, $clock2, $case->{description}
        : isnt $clock1, $clock2, $case->{description};
    }
  }

stub: |-
  sub new {
    my ($class, $attributes) = @_;
    return bless $attributes, $class;
  }

  sub time {
    my ($self) = @_;
    return undef;
  }

  sub add_minutes {
    my ($self, $amount) = @_;
    return undef;
  }

  sub subtract_minutes {
    my ($self, $amount) = @_;
    return undef;
  }

example: |-
  use POSIX;

  sub new {
    my ($class, $attributes) = @_;
    my $self = {
      hour   => $attributes->{hour} || 0,
      minute => $attributes->{minute} || 0,
    };
    return bless($self, $class)->BUILD;
  }

  sub time {
    my ($self) = @_;
    return sprintf '%02d:%02d', $self->{hour}, $self->{minute};
  }

  sub add_minutes {
    my ($self, $amount) = @_;
    $self->{minute} += $amount;
    return $self->BUILD;
  }

  sub subtract_minutes {
    my ($self, $amount) = @_;
    return $self->add_minutes(-$amount);
  }

  sub BUILD {
    my ($self) = @_;
    $self->{hour} = ( $self->{hour} + floor($self->{minute} / 60) ) % 24;
    $self->{minute} %= 60;
    return $self;
  }
